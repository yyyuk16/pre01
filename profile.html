<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="„Éó„É≠„Éï„Ç£„Éº„É´Ë®≠ÂÆö">„Éó„É≠„Éï„Ç£„Éº„É´Ë®≠ÂÆö</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="maintab.css">
    <!-- FontAwesomeÔºà„Ç¢„Ç§„Ç≥„É≥Áî®Ôºâ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- ÁøªË®≥Ê©üËÉΩ -->
    <script src="translation.js"></script>
    
    <style>
        body {
            background: var(--background-gradient, #E8F5E9);
        }
        .profile-main-content {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 60vh;
            padding: 40px 0 32px 0;
        }
        .profile-card {
            background: var(--card-bg, #fff);
            border-radius: var(--border-radius-lg, 32px);
            box-shadow: 0 4px 24px var(--shadow-color, rgba(67,160,71,0.10));
            padding: 40px 32px 32px 32px;
            min-width: 340px;
            max-width: 420px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            transition: box-shadow 0.2s;
        }
        .profile-card:hover {
            box-shadow: 0 8px 32px var(--shadow-color-strong, rgba(67,160,71,0.18));
        }
        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 28px;
        }
        .profile-avatar {
            width: 84px;
            height: 84px;
            border-radius: 50%;
            background: var(--primary-color, #43A047);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.6em;
            color: #fff;
            font-weight: 700;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px var(--shadow-color, rgba(67,160,71,0.10));
            border: 4px solid #fff;
        }
        .profile-title {
            font-size: 1.35em;
            color: var(--primary-color, #43A047);
            font-weight: 600;
            letter-spacing: 0.04em;
        }
        .profile-list {
            width: 100%;
            margin: 0 0 24px 0;
        }
        .profile-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--background-color, #E8F5E9);
            border-radius: var(--border-radius-md, 16px);
            padding: 14px 18px;
            margin-bottom: 12px;
            box-shadow: 0 1px 4px var(--shadow-color, rgba(67,160,71,0.07));
            font-size: 1.08em;
            transition: background 0.2s;
        }
        .profile-label {
            display: flex;
            align-items: center;
            color: var(--secondary-color, #2E7D32);
            font-weight: 500;
            gap: 8px;
        }
        .profile-label i {
            font-size: 1.1em;
            margin-right: 2px;
        }
        .profile-value {
            color: var(--text-color, #1A1A1A);
            font-weight: 400;
            word-break: break-all;
        }
        .delete-btn {
            background: linear-gradient(90deg, #f44336 0%, #e57373 100%);
            color: #fff;
            border: none;
            border-radius: var(--border-radius-md, 16px);
            padding: 12px 36px;
            font-size: 1.08em;
            font-weight: 600;
            letter-spacing: 0.04em;
            margin-top: 8px;
            cursor: pointer;
            box-shadow: 0 2px 8px var(--shadow-color, rgba(244,67,54,0.10));
            transition: background 0.18s, box-shadow 0.18s;
        }
        .delete-btn:hover {
            background: linear-gradient(90deg, #e53935 0%, #ef5350 100%);
            box-shadow: 0 4px 16px var(--shadow-color-strong, rgba(244,67,54,0.18));
        }
        @media (max-width: 600px) {
            .profile-card {
                min-width: 0;
                max-width: 98vw;
                padding: 24px 6vw 18px 6vw;
            }
            .profile-main-content {
                padding: 18px 0 12px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ÂåªÁôÇÊÉÖÂ†±ÁÆ°ÁêÜ„Ç¢„Éó„É™</h1>
        </div>
        
        <div class="tab-container">
            <div class="tab-header">
                <button class="tab-button" onclick="location.href='ai.html'">
                    <span class="tab-icon">üí¨</span>
                    <span class="tab-text">„ÉÅ„É£„ÉÉ„Éà</span>
                </button>
                <button class="tab-button" onclick="location.href='score.html'">
                    <span class="tab-icon">‚ùì</span>
                    <span class="tab-text">Q&A</span>
                </button>
                <button class="tab-button" onclick="location.href='movie.html'">
                    <span class="tab-icon">üé¨</span>
                    <span class="tab-text">ÂãïÁîªË¶ñËÅ¥</span>
                </button>
                <button class="tab-button active" onclick="location.href='profile.html'">
                    <span class="tab-icon">üë§</span>
                    <span class="tab-text">„Éó„É≠„Éï„Ç£„Éº„É´</span>
                </button>
            </div>
        </div>

        <!-- „Åì„Åì„Åã„Çâ‰∏ã„ÇíÊñ∞„Åó„ÅÑ„Éá„Ç∂„Ç§„É≥„Åß„É™„É©„Ç§„Éà -->
        <div class="profile-main-content">
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">
                        <span id="profileInitial">?</span>
                    </div>
                    <h2 class="profile-title">ÁôªÈå≤ÊÉÖÂ†±</h2>
                </div>
                <div class="profile-list" id="profileList">
                    <!-- „Éó„É≠„Éï„Ç£„Éº„É´ÊÉÖÂ†±„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                </div>
                <button id="deleteAccountBtn" class="delete-btn">
                    <i class="fas fa-user-slash"></i> Ê≤ªÁôÇÂÆå‰∫ÜÔºàÈÄÄ‰ºöÔºâ
                </button>
            </div>
        </div>
        <!-- „Åì„Åì„Åæ„Åß -->

        <script>
            // FirebaseÂàùÊúüÂåñ
            const firebaseConfig = {
                apiKey: "AIzaSyC31W-TEE7mIBGFwrRxJAuPugjnEFfWe_k",
                authDomain: "web01-2484d.firebaseapp.com",
                projectId: "web01-2484d",
                storageBucket: "web01-2484d.appspot.com",
                messagingSenderId: "90159472898",
                appId: "1:90159472898:web:261ec71f9919611011e21b"
            };
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }

            // „Éó„É≠„Éï„Ç£„Éº„É´ÊÉÖÂ†±ÂèñÂæóÔºÜË°®Á§∫
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    const db = firebase.firestore();
                    db.collection('users').doc(user.uid).get()
                        .then((doc) => {
                            if (doc.exists) {
                                const data = doc.data();
                                // „Ç¢„Ç§„Ç≥„É≥Áî®„Ç§„Éã„Ç∑„É£„É´
                                let initial = "Ôºü";
                                if (data.name && typeof data.name === "string" && data.name.length > 0) {
                                    initial = data.name[0];
                                }
                                document.getElementById('profileInitial').textContent = initial;

                                const listDiv = document.getElementById('profileList');
                                listDiv.innerHTML = '';
                                // Ë°®Á§∫È†Ü„ÇíÊåáÂÆö
                                const order = [
                                    'name', 'gender', 'age', 'email', 'assignedDoctor',
                                    'specialty', 'qualifications', 'hospital', 'experience'
                                ];
                                order.forEach(async key => {
                                    let value = data[key];
                                    let label = key;
                                    let icon = '';
                                    let skip = false;
                                    switch(key) {
                                      case 'name': label = 'ÂêçÂâç'; icon = '<i class="fas fa-user"></i>'; break;
                                      case 'gender': label = 'ÊÄßÂà•'; icon = '<i class="fas fa-venus-mars"></i>'; break;
                                      case 'age': label = 'Âπ¥ÈΩ¢'; value = value ? value + 'Ê≠≥' : ''; icon = '<i class="fas fa-birthday-cake"></i>'; break;
                                      case 'email': label = '„É°„Éº„É´'; icon = '<i class="fas fa-envelope"></i>'; break;
                                      case 'assignedDoctor':
                                        label = 'ÊãÖÂΩìÂåª'; icon = '<i class="fas fa-user-md"></i>';
                                        if (value) {
                                          try {
                                            const docSnap = await db.collection('users').doc(value).get();
                                            value = docSnap.exists ? (docSnap.data().name || '-') : '-';
                                          } catch (e) {
                                            value = '-';
                                          }
                                        } else {
                                          value = '-';
                                        }
                                        break;
                                      case 'specialty': label = 'Â∞ÇÈñÄ'; icon = '<i class="fas fa-stethoscope"></i>'; break;
                                      case 'qualifications': label = 'Ë≥áÊ†º'; icon = '<i class="fas fa-certificate"></i>'; break;
                                      case 'hospital': label = 'ÁóÖÈô¢'; icon = '<i class="fas fa-hospital"></i>'; break;
                                      case 'experience': label = 'Âã§ÂãôÂπ¥Êï∞'; value = value ? value + 'Âπ¥' : ''; icon = '<i class="fas fa-clock"></i>'; break;
                                      default: skip = true; break;
                                    }
                                    if (!skip && value !== undefined) {
                                      listDiv.innerHTML += `<div class='profile-row'><div class='profile-label'>${icon}<span>${label}</span></div><span class='profile-value'>${value}</span></div>`;
                                    }
                                });
                            }
                        })
                        .catch((error) => {
                            console.error("Error fetching user profile:", error);
                        });
                }
            });

            // ÈÄÄ‰ºöÂá¶ÁêÜ
            document.getElementById('deleteAccountBtn').onclick = function() {
                if (!confirm('Êú¨ÂΩì„Å´ÈÄÄ‰ºö„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ')) return;
                const user = firebase.auth().currentUser;
                if (!user) return alert('„É≠„Ç∞„Ç§„É≥ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                const db = firebase.firestore();
                // Firestore„ÅÆ„É¶„Éº„Ç∂„Éº„Éá„Éº„ÇøÂâäÈô§
                db.collection('users').doc(user.uid).delete()
                    .then(() => {
                        // Auth„É¶„Éº„Ç∂„ÉºÂâäÈô§
                        user.delete().then(() => {
                            alert('ÈÄÄ‰ºö„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
                            window.location.href = 'index.html';
                        }).catch((error) => {
                            if (error.code === 'auth/requires-recent-login') {
                                const pw = prompt('ÂÜçË™çË®º„ÅÆ„Åü„ÇÅ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                                if (!pw) return alert('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂøÖË¶Å„Åß„Åô');
                                const cred = firebase.auth.EmailAuthProvider.credential(user.email, pw);
                                user.reauthenticateWithCredential(cred).then(() => {
                                    user.delete().then(() => {
                                        alert('ÈÄÄ‰ºö„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
                                        window.location.href = 'index.html';
                                    });
                                }).catch((e) => {
                                    alert('ÂÜçË™çË®º„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + e.message);
                                });
                            } else {
                                alert('ÈÄÄ‰ºöÂá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
                            }
                        });
                    })
                    .catch((error) => {
                        alert('ÈÄÄ‰ºöÂá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
                    });
            };
        </script>
    </body>
</html>