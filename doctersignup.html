<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="title">åŒ»è€…æ–°è¦ç™»éŒ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="d_sign.css">
  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  
  <!-- å¤šè¨€èªå¯¾å¿œã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script src="translation.js"></script>
  <script src="firebase-translations.js"></script>
</head>
<body>
  <!-- è¨€èªé¸æŠã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -->
  <div class="language-selector">
    <div class="language-selector-container">
      <label for="languageSelect" class="language-label">
        <span class="language-icon">ğŸŒ</span>
        <span class="language-text" data-i18n="language">è¨€èª</span>
      </label>
      <select id="languageSelect" class="language-select" onchange="changeLanguage(this.value)">
        <option value="ja" data-i18n="ja">æ—¥æœ¬èª</option>
        <option value="en" data-i18n="en">English</option>
        <option value="zh" data-i18n="zh">ä¸­æ–‡</option>
        <option value="ko" data-i18n="ko">í•œêµ­ì–´</option>
        <option value="es" data-i18n="es">EspaÃ±ol</option>
        <option value="fr" data-i18n="fr">FranÃ§ais</option>
        <option value="de" data-i18n="de">Deutsch</option>
      </select>
    </div>
  </div>

  <div class="container">
    <h1 data-i18n="signup-title">åŒ»ç™‚ç®¡ç†ã‚¢ãƒ—ãƒª</h1>
    <form id="signupForm">
      <div class="form-group">
        <label for="name" data-i18n="name">ãŠåå‰</label>
        <input type="text" id="name" required>
      </div>
      <div class="form-group">
        <label for="gender" data-i18n="gender">æ€§åˆ¥</label>
        <select id="gender" required>
          <option value="" data-i18n="select">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="male" data-i18n="male">ç”·æ€§</option>
          <option value="female" data-i18n="female">å¥³æ€§</option>
          <option value="other" data-i18n="other">ãã®ä»–</option>
        </select>
      </div>
      <div class="form-group">
        <label for="age" data-i18n="age">å¹´é½¢</label>
        <input type="number" id="age" min="0" max="120" required>
      </div>
      <div class="form-group">
        <label for="language" data-i18n="language">è¨€èªé¸æŠ</label>
        <select id="language" required onchange="changeLanguage(this.value)">
          <option value="" data-i18n="select">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="ja" data-i18n="ja">æ—¥æœ¬èª</option>
          <option value="en" data-i18n="en">English</option>
          <option value="zh" data-i18n="zh">ä¸­æ–‡</option>
          <option value="ko" data-i18n="ko">í•œêµ­ì–´</option>
        </select>
      </div>
      <div class="form-group">
        <label for="email" data-i18n="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input type="email" id="email" required>
      </div>
      <div class="form-group">
        <label for="specialty" data-i18n="specialty">å°‚é–€</label>
        <select id="specialty" required>
          <option value="" data-i18n="select">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="å†…ç§‘" data-i18n="internal-medicine">å†…ç§‘</option>
          <option value="å¤–ç§‘" data-i18n="surgery">å¤–ç§‘</option>
          <option value="å°å…ç§‘" data-i18n="pediatrics">å°å…ç§‘</option>
          <option value="æ•´å½¢å¤–ç§‘" data-i18n="orthopedics">æ•´å½¢å¤–ç§‘</option>
          <option value="çš®è†šç§‘" data-i18n="dermatology">çš®è†šç§‘</option>
          <option value="ç²¾ç¥ç§‘" data-i18n="psychiatry">ç²¾ç¥ç§‘</option>
          <option value="çœ¼ç§‘" data-i18n="ophthalmology">çœ¼ç§‘</option>
          <option value="è€³é¼»å’½å–‰ç§‘" data-i18n="otolaryngology">è€³é¼»å’½å–‰ç§‘</option>
          <option value="ç”£å©¦äººç§‘" data-i18n="obstetrics-gynecology">ç”£å©¦äººç§‘</option>
          <option value="ãã®ä»–" data-i18n="other">ãã®ä»–</option>
        </select>
      </div>
      <div class="form-group">
        <label for="hospital" data-i18n="hospital">ç—…é™¢</label>
        <input type="text" id="hospital">
      </div>
      <div class="form-group">
        <label for="experience" data-i18n="experience">å‹¤å‹™å¹´æ•°</label>
        <input type="number" id="experience" min="0">
      </div>
      <div class="form-group">
        <label for="password" data-i18n="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" id="password" >
      </div>
      <div class="form-group">
        <label for="confirmPassword" data-i18n="confirm-password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰</label>
        <input type="password" id="confirmPassword" >
      </div>
      
      <button type="submit" data-i18n="register">ç™»éŒ²</button>
    </form>
    <a href="index.html" class="back-link" data-i18n="back-to-login">â† ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</a>
  </div>

  <style>
  .language-selector {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 12px 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
  }

  .language-selector:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .language-selector-container {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .language-label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 500;
    color: #333;
    cursor: pointer;
  }

  .language-icon {
    font-size: 16px;
  }

  .language-text {
    white-space: nowrap;
  }

  .language-select {
    padding: 6px 12px;
    border: 2px solid #e1e8ed;
    border-radius: 8px;
    background: white;
    font-size: 14px;
    color: #333;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 120px;
  }

  .language-select:focus {
    outline: none;
    border-color: #42a5f5;
    box-shadow: 0 0 0 3px rgba(66, 165, 245, 0.1);
  }

  .language-select:hover {
    border-color: #42a5f5;
  }

  @media (max-width: 768px) {
    .language-selector {
      top: 10px;
      right: 10px;
      padding: 8px 12px;
    }
    
    .language-label {
      font-size: 12px;
    }
    
    .language-select {
      font-size: 12px;
      min-width: 100px;
      padding: 4px 8px;
    }
  }

  @media (max-width: 480px) {
    .language-selector {
      position: relative;
      top: auto;
      right: auto;
      margin: 10px auto;
      width: fit-content;
    }
    
    .language-text {
      display: none;
    }
  }
  </style>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC31W-TEE7mIBGFwrRxJAuPugjnEFfWe_k",
      authDomain: "web01-2484d.firebaseapp.com",
      projectId: "web01-2484d",
      storageBucket: "web01-2484d.appspot.com",
      messagingSenderId: "90159472898",
      appId: "1:90159472898:web:261ec71f9919611011e21b"
    };
    firebase.initializeApp(firebaseConfig);

    // æ–°ã—ã„å¤šè¨€èªã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨
    // ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã¯ translation.js ã¨ firebase-translations.js ã§ç®¡ç†ã•ã‚Œã¾ã™

    document.getElementById('signupForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const name = document.getElementById('name').value;
  const age = document.getElementById('age').value;
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const language = document.getElementById('language').value;
  const specialty = document.getElementById('specialty').value;
  const hospital = document.getElementById('hospital').value;
  const experience = document.getElementById('experience').value;

  if (password !== confirmPassword) {
    const errorMessage = window.translationManager ? 
      window.translationManager.getText('password-mismatch', 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“') : 
      'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“';
    alert(errorMessage);
    return;
  }

  firebase.auth().createUserWithEmailAndPassword(email, password)
    .then((userCredential) => {
      const user = userCredential.user;

      // Firestoreã®usersã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ä¿å­˜ï¼ˆã“ã®UIDãŒ doctorId ã¨ã—ã¦æ‚£è€…ãŒå‚ç…§ã™ã‚‹ï¼‰
      return firebase.firestore().collection('users').doc(user.uid).set({
        name: name,
        email: email,
        age:age,
        language: language,
        role: 'staff',  // åŒ»è€…
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        specialty: specialty,
        hospital: hospital,
        experience: experience
      });
    })
    .then(() => {
      const successMessage = window.translationManager ? 
        window.translationManager.getText('registration-success', 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼') : 
        'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼';
      alert(successMessage);

      // ç™»éŒ²å¾Œã®é·ç§»å…ˆï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ï¼‰
      window.location.href = 'home.html';
    })
    .catch((error) => {
      const errorMessage = window.translationManager ? 
        window.translationManager.getText('registration-error', 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ') : 
        'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ';
      alert(errorMessage + error.message);
    });
});

  </script>
</body>
</html>
